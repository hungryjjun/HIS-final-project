<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mybatis.mappers.file.FileMapper">

    <!-- ðŸ”¹ FILE_ID ìƒì„± (ë¶€ëª¨ í…Œì´ë¸”) -->
    <insert id="insertFile" parameterType="kr.or.ddit.file.vo.FileVO">
        <selectKey keyProperty="fileId" resultType="Long" order="BEFORE">
            SELECT FILE_ID_SEQ.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO "FILE" (FILE_ID, FILE_DEL)
        VALUES (#{fileId}, 'N') <!-- ê¸°ë³¸ê°’ 'N' (ì‚­ì œë˜ì§€ ì•ŠìŒ) -->
    </insert>


    <!-- íŒŒì¼ ìƒì„¸ ì •ë³´ ì‚½ìž… (ìžì‹ í…Œì´ë¸”) -->
    <insert id="insertFileDetail" parameterType="kr.or.ddit.file.vo.FileDetailVO">
        INSERT INTO FILE_DETAIL 
            (DETAIL_ID, FILE_ID, FILE_NAME, FILE_SAVENAME, FILE_PATH, FILE_STATUS, FILE_SIZE, FILE_TYPE, UPLOAD_DATE)
        VALUES 
            (FILE_DETAIL_SEQ.NEXTVAL, 
             #{fileId}, <!-- ë¶€ëª¨ í…Œì´ë¸”ì—ì„œ ë°˜í™˜ëœ FILE_ID -->
             #{fileName}, 
             #{fileSavename}, 
             #{filePath}, 
             'N', 
             #{fileSize}, 
             #{fileType}, 
             SYSDATE)
    </insert>

    <!-- íŒŒì¼ ì‚­ì œ (ìƒíƒœ ë³€ê²½) -->
    <update id="deleteFile" parameterType="long">
        UPDATE FILE_DETAIL 
        SET FILE_STATUS = 'Y' 
        WHERE FILE_ID = #{fileId}
    </update>

    <!-- íŒŒì¼ ëª©ë¡ ì¡°íšŒ -->
    <select id="getAllFiles" resultType="kr.or.ddit.file.vo.FileDetailVO">
        SELECT 
            DETAIL_ID, FILE_ID, FILE_NAME, FILE_SAVENAME, FILE_PATH, FILE_STATUS, FILE_SIZE, FILE_TYPE, UPLOAD_DATE
        FROM FILE_DETAIL 
        WHERE FILE_STATUS = 'N'
        ORDER BY UPLOAD_DATE DESC
    </select>

    <!-- íŒŒì¼ ìƒì„¸ ì¡°íšŒ -->
    <select id="getFileById" parameterType="long" resultType="kr.or.ddit.file.vo.FileDetailVO">
        SELECT 
            DETAIL_ID, FILE_ID, FILE_NAME, FILE_SAVENAME, FILE_PATH, FILE_STATUS, FILE_SIZE, FILE_TYPE, UPLOAD_DATE
        FROM FILE_DETAIL
        WHERE FILE_ID = #{fileId}
    </select>

</mapper>
