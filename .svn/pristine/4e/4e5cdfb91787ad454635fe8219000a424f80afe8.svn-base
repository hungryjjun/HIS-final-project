
function connectWebSocket() {
    console.log("ğŸ”Œ WebSocket ì—°ê²° ì‹œë„...");
    
    let socket = new SockJS('/wss');  // ì„œë²„ì— ì—°ê²°
    stompClient = Stomp.over(socket);

    stompClient.connect({}, function (frame) {
        console.log("âœ… WebSocket ì—°ê²° ì„±ê³µ: " + frame);

        // ì„œë²„ì—ì„œ ì „ì†¡ëœ ì˜¨ë¼ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ ìˆ˜ì‹ 
        stompClient.subscribe('/topic/onlineStatus', function (message) {
            let statusUpdate = message.body;
            console.log("ğŸ”„ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤í–‰: ", statusUpdate);
            alert(statusUpdate);
            loadEmployeeList(); // ìƒíƒœê°€ ë³€ê²½ë˜ë©´ ì§ì› ëª©ë¡ì„ ë‹¤ì‹œ ë¡œë“œ
        });
    }, function (error) {
        console.error("âŒ WebSocket ì—°ê²° ì‹¤íŒ¨", error);
    });
}

// ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” AJAX í•¨ìˆ˜
function loadEmployeeList() {
    console.log("ì§ì› ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°");

    $.ajax({
        url: "/messenger/empList",
        type: "GET",
        dataType: "json",
        success: function (data) {
            console.log("ì§ì› ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ", data);

            let empListHtml = `
                <h3>ì§ì› ëª©ë¡</h3>
                <ul id="empList">
            `;

            data.forEach(emp => {
                empListHtml += `
                    <li class="employee-item">
                        <strong>ì´ë¦„:</strong> ${emp.empName} <br>
                        <strong>ë¶€ì„œ:</strong> ${emp.department.departmentName} <br>
                        <strong>ì§ê¸‰:</strong> ${emp.empRank} <br>
                        <strong>íŒ€:</strong> ${emp.teamName} <br>
                        <strong>ìƒíƒœ:</strong> ${emp.statuString === 'ì˜¨ë¼ì¸' ? 'ğŸŸ¢ ì˜¨ë¼ì¸' : 'âšª ì˜¤í”„ë¼ì¸'} <br>
                    </li>
                `;
            });

            empListHtml += `</ul>`;
            $("#contentArea").html(empListHtml);
        },
        error: function (xhr, status, error) {
            console.error("ì§ì›ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨", status, error);
            alert("ì‹¤íŒ¨í•¨");
        }
    });
}

$(document).ready(function () {
	console.log("chatempList.js ê°€ì ¸ì™”ìŒ")
    connectWebSocket();
    loadEmployeeList();

    // ì§ì› ëª©ë¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
    $("#empListBtn").on("click", function (e) {
        e.preventDefault();
        console.log("ì§ì› ëª©ë¡ ë²„íŠ¼ í´ë¦­");
        loadEmployeeList();
    });


});
