function connectWebSocket() {
    console.log("ğŸ”Œ WebSocket ì—°ê²° ì‹œë„...");

    let socket = new SockJS('/wss');  // ì„œë²„ì™€ì˜ ì—°ê²°
    stompClient = Stomp.over(socket);

    stompClient.connect({}, function (frame) {
        console.log("âœ… WebSocket ì—°ê²° ì„±ê³µ: " + frame);

        // ìƒíƒœ ë³€ê²½ ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ
        stompClient.subscribe('/topic/onlineStatus', function (message) {
            let statusUpdate = message.body;
            console.log("ğŸ”„ ìƒíƒœ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ : ", statusUpdate);

            // ì•Œë¦¼ì€ dev ìš©ë„ë¡œë§Œ ìœ ì§€
            // alert(statusUpdate);

            // ì§ì› ëª©ë¡ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
            loadEmployeeList();
        });
    }, function (error) {
        console.error("âŒ WebSocket ì—°ê²° ì‹¤íŒ¨", error);
    });
}

function loadEmployeeList() {
    console.log("ğŸ“¥ ì§ì› ëª©ë¡ ìš”ì²­");

    $.ajax({
        url: "/messenger/empList",
        type: "GET",
        dataType: "json",
        success: function (data) {
            console.log("ğŸ“‹ ì§ì› ëª©ë¡ ìˆ˜ì‹  ì™„ë£Œ", data);

            let empListHtml = `
                <h3>ì§ì› ëª©ë¡</h3>
                <ul id="empList">
            `;

            data.forEach(emp => {
                empListHtml += `
                    <li class="employee-item" style="margin-bottom: 10px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">
                        <strong>ì´ë¦„:</strong> ${emp.empName}<br>
                        <strong>ë¶€ì„œ:</strong> ${emp.department?.departmentName || 'N/A'}<br>
                        <strong>ì§ê¸‰:</strong> ${emp.empRank}<br>
                        <strong>íŒ€:</strong> ${emp.teamName}<br>
                        <strong>ìƒíƒœ:</strong> ${emp.status === 'ì˜¨ë¼ì¸' ? 'ğŸŸ¢ ì˜¨ë¼ì¸' : 'âšª ì˜¤í”„ë¼ì¸'}
                    </li>
                `;
            });

            empListHtml += `</ul>`;
            $("#contentArea").html(empListHtml);
        },
        error: function (xhr, status, error) {
            console.error("âŒ ì§ì› ëª©ë¡ ë¡œë”© ì‹¤íŒ¨", status, error);
            alert("ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    });
}

$(document).ready(function () {
    console.log("ğŸ“¦ chatempList.js ë¡œë“œë¨");

    connectWebSocket();
    loadEmployeeList();

    $("#empListBtn").on("click", function (e) {
        e.preventDefault();
        console.log("ğŸ‘† ì§ì› ëª©ë¡ ë²„íŠ¼ í´ë¦­ë¨");
        loadEmployeeList();
    });
});
